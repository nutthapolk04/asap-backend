# ASAP Car Rental - Backoffice CMS (Strapi)

## Project Overview

**Project:** ASAP Car Rental Backoffice CMS
**Framework:** Strapi v4 (Self-hosted)
**Database:** PostgreSQL
**Media Storage:** AWS S3
**Frontend:** Vue.js 3 + Vite (same stack as main website)

---

## Tech Stack

| Component | Technology |
|-----------|------------|
| CMS | Strapi v4 |
| Database | PostgreSQL |
| Media Storage | AWS S3 |
| Hosting | Self-hosted |
| Frontend Admin | Strapi Admin Panel |

---

## Content Types (Collections)

### 1. Hero Banner

จัดการ Banner หลักหน้า Home Page

| Field | Type | Required | Note |
|-------|------|----------|------|
| title | Text | ✅ | ชื่อ Banner (สำหรับ Admin) |
| image_desktop | Media | ✅ | รูป Desktop |
| image_mobile | Media | ✅ | รูป Mobile |
| link | Text | ❌ | URL เมื่อ Click |
| order | Number | ✅ | ลำดับการแสดง (1-5) |
| is_active | Boolean | ✅ | เปิด/ปิดการแสดง |

**Constraints:**
- Maximum: 5 banners
- Drag & Drop ordering

---

### 2. Promotion Campaign

จัดการ Promotion Carousel "ลดเฉพาะช่วงนี้"

| Field | Type | Required | Note |
|-------|------|----------|------|
| title | Text | ✅ | ชื่อ Campaign (สำหรับ Admin) |
| image | Media | ✅ | รูป Promotion (736x507) |
| link | Text | ❌ | URL เมื่อ Click |
| start_date | DateTime | ✅ | วันเริ่มแสดง |
| end_date | DateTime | ✅ | วันสิ้นสุดการแสดง |
| order | Number | ✅ | ลำดับการแสดง |
| is_active | Boolean | ✅ | เปิด/ปิดการแสดง |

**Constraints:**
- Maximum: 3 campaigns
- Auto show/hide based on date range
- Drag & Drop ordering

---

### 3. Province Card

จัดการ Province/Location Cards หน้า Home Page

| Field | Type | Required | Note |
|-------|------|----------|------|
| name | Text | ✅ | ชื่อจังหวัด (Admin พิมพ์เอง) |
| image | Media | ✅ | รูปจังหวัด (570x320) |
| link | Text | ❌ | URL เมื่อ Click |
| order | Number | ✅ | ลำดับการแสดง |
| is_active | Boolean | ✅ | เปิด/ปิดการแสดง |

**Constraints:**
- Maximum: 10 provinces
- Drag & Drop ordering

---

### 4. Article Category

จัดการหมวดหมู่บทความ

| Field | Type | Required | Note |
|-------|------|----------|------|
| name | Text | ✅ | ชื่อหมวดหมู่ |
| slug | UID | ✅ | Auto-generate จาก name |
| order | Number | ✅ | ลำดับการแสดง |
| is_active | Boolean | ✅ | เปิด/ปิดการแสดง |

**Features:**
- สร้าง Category ได้ไม่จำกัด
- Drag & Drop ordering

---

### 5. Article

จัดการบทความ

| Field | Type | Required | Note |
|-------|------|----------|------|
| title | Text | ✅ | หัวข้อบทความ |
| slug | UID | ✅ | Auto-generate จาก title |
| category | Relation | ✅ | เชื่อมกับ Article Category |
| cover_image | Media | ✅ | รูปหน้าปก (302x302) |
| content | Rich Text | ✅ | เนื้อหาบทความ |
| published_date | Date | ✅ | วันที่เผยแพร่ |
| meta_title | Text | ❌ | SEO Title |
| meta_description | Text | ❌ | SEO Description |
| status | Enum | ✅ | Draft / Published |

**Rich Text Features:**
- Bold, Italic, Underline
- Insert Images
- Embed Video (YouTube)
- Tables
- Lists (Ordered/Unordered)
- Links

---

### 6. FAQ Category

จัดการหมวดหมู่ FAQ

| Field | Type | Required | Note |
|-------|------|----------|------|
| name | Text | ✅ | ชื่อหมวดหมู่ |
| order | Number | ✅ | ลำดับการแสดง |
| is_active | Boolean | ✅ | เปิด/ปิดการแสดง |

**Features:**
- สร้าง Category ได้ไม่จำกัด
- Drag & Drop ordering

---

### 7. FAQ

จัดการคำถามที่พบบ่อย

| Field | Type | Required | Note |
|-------|------|----------|------|
| title | Text | ✅ | คำถาม |
| detail | Rich Text | ✅ | คำตอบ |
| category | Relation | ✅ | เชื่อมกับ FAQ Category |
| order | Number | ✅ | ลำดับการแสดง |
| status | Enum | ✅ | Draft / Published |

**Rich Text Features:**
- Bold, Italic, Underline
- Insert Images
- Embed Video
- Lists

---

### 8. Contact Us (Single Type)

จัดการข้อมูลหน้าติดต่อเรา

| Field | Type | Required | Note |
|-------|------|----------|------|
| hero_image | Media | ❌ | รูป Hero |
| phone | Text | ✅ | เบอร์โทรศัพท์ |
| email | Text | ✅ | อีเมล |
| line_id | Text | ❌ | LINE ID |
| address | Text | ✅ | ที่อยู่ |
| map_embed | Text | ❌ | Google Maps Embed Code |
| working_hours | Text | ❌ | เวลาทำการ |

---

### 9. Privacy Policy (Single Type)

จัดการหน้านโยบายความเป็นส่วนตัว

| Field | Type | Required | Note |
|-------|------|----------|------|
| title | Text | ✅ | หัวข้อ |
| content | Rich Text | ✅ | เนื้อหา |
| last_updated | Date | ✅ | วันที่อัปเดตล่าสุด |

---

## User Roles & Permissions

### 1. Super Admin
- ✅ จัดการ Content ทั้งหมด
- ✅ จัดการ Users
- ✅ จัดการ Roles & Permissions
- ✅ เข้าถึง Settings
- ✅ จัดการ Media Library

### 2. Editor
- ✅ จัดการ Content ทั้งหมด
- ✅ จัดการ Media Library
- ❌ จัดการ Users
- ❌ จัดการ Settings

### 3. Viewer
- ✅ ดู Content (Read Only)
- ❌ สร้าง/แก้ไข/ลบ Content
- ❌ จัดการ Users
- ❌ จัดการ Settings

---

## API Endpoints (Auto-generated by Strapi)

### Hero Banners
```
GET    /api/hero-banners
GET    /api/hero-banners/:id
POST   /api/hero-banners
PUT    /api/hero-banners/:id
DELETE /api/hero-banners/:id
```

### Promotion Campaigns
```
GET    /api/promotion-campaigns
GET    /api/promotion-campaigns/:id
POST   /api/promotion-campaigns
PUT    /api/promotion-campaigns/:id
DELETE /api/promotion-campaigns/:id
```

### Province Cards
```
GET    /api/province-cards
GET    /api/province-cards/:id
POST   /api/province-cards
PUT    /api/province-cards/:id
DELETE /api/province-cards/:id
```

### Articles
```
GET    /api/articles
GET    /api/articles/:id
GET    /api/articles?filters[slug][$eq]=:slug
POST   /api/articles
PUT    /api/articles/:id
DELETE /api/articles/:id
```

### Article Categories
```
GET    /api/article-categories
GET    /api/article-categories/:id
POST   /api/article-categories
PUT    /api/article-categories/:id
DELETE /api/article-categories/:id
```

### FAQs
```
GET    /api/faqs
GET    /api/faqs/:id
POST   /api/faqs
PUT    /api/faqs/:id
DELETE /api/faqs/:id
```

### FAQ Categories
```
GET    /api/faq-categories
GET    /api/faq-categories/:id
POST   /api/faq-categories
PUT    /api/faq-categories/:id
DELETE /api/faq-categories/:id
```

### Contact Us (Single Type)
```
GET    /api/contact-us
PUT    /api/contact-us
```

### Privacy Policy (Single Type)
```
GET    /api/privacy-policy
PUT    /api/privacy-policy
```

---

## Environment Variables

```env
# Server
HOST=0.0.0.0
PORT=1337
APP_KEYS=your-app-keys
API_TOKEN_SALT=your-api-token-salt
ADMIN_JWT_SECRET=your-admin-jwt-secret
JWT_SECRET=your-jwt-secret

# Database (PostgreSQL)
DATABASE_CLIENT=postgres
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=asap_cms
DATABASE_USERNAME=your-username
DATABASE_PASSWORD=your-password
DATABASE_SSL=false

# AWS S3
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_REGION=ap-southeast-1
AWS_BUCKET=asap-cms-media
```

---

## Installation & Setup

### Prerequisites
- Node.js v18+ (LTS)
- PostgreSQL 14+
- AWS Account (for S3)

### 1. Create Strapi Project
```bash
npx create-strapi-app@latest asap-backoffice --quickstart
cd asap-backoffice
```

### 2. Install PostgreSQL Plugin
```bash
npm install pg
```

### 3. Install AWS S3 Provider
```bash
npm install @strapi/provider-upload-aws-s3
```

### 4. Configure Database
Edit `config/database.js`:
```javascript
module.exports = ({ env }) => ({
  connection: {
    client: 'postgres',
    connection: {
      host: env('DATABASE_HOST', 'localhost'),
      port: env.int('DATABASE_PORT', 5432),
      database: env('DATABASE_NAME', 'asap_cms'),
      user: env('DATABASE_USERNAME', 'postgres'),
      password: env('DATABASE_PASSWORD', ''),
      ssl: env.bool('DATABASE_SSL', false),
    },
  },
});
```

### 5. Configure S3 Upload
Edit `config/plugins.js`:
```javascript
module.exports = ({ env }) => ({
  upload: {
    config: {
      provider: 'aws-s3',
      providerOptions: {
        accessKeyId: env('AWS_ACCESS_KEY_ID'),
        secretAccessKey: env('AWS_SECRET_ACCESS_KEY'),
        region: env('AWS_REGION'),
        params: {
          Bucket: env('AWS_BUCKET'),
        },
      },
      actionOptions: {
        upload: {},
        uploadStream: {},
        delete: {},
      },
    },
  },
});
```

### 6. Run Development Server
```bash
npm run develop
```

### 7. Access Admin Panel
```
http://localhost:1337/admin
```

---

## Deployment Checklist

- [ ] PostgreSQL database created
- [ ] AWS S3 bucket created with proper permissions
- [ ] Environment variables configured
- [ ] Content Types created
- [ ] User Roles configured
- [ ] API permissions set
- [ ] CORS configured for frontend domain
- [ ] SSL certificate installed (production)

---

## Frontend Integration (Vue.js)

### Install Strapi SDK
```bash
npm install @strapi/strapi
# or use axios
npm install axios
```

### Example: Fetch Hero Banners
```javascript
// composables/useStrapi.js
import axios from 'axios';

const strapiAPI = axios.create({
  baseURL: import.meta.env.VITE_STRAPI_URL || 'http://localhost:1337/api',
});

export const useStrapi = () => {
  const getHeroBanners = async () => {
    const { data } = await strapiAPI.get('/hero-banners', {
      params: {
        populate: '*',
        sort: 'order:asc',
        filters: {
          is_active: { $eq: true }
        }
      }
    });
    return data.data;
  };

  const getArticles = async (categorySlug = null) => {
    const params = {
      populate: ['category', 'cover_image'],
      sort: 'published_date:desc',
      filters: {
        status: { $eq: 'published' }
      }
    };

    if (categorySlug) {
      params.filters.category = { slug: { $eq: categorySlug } };
    }

    const { data } = await strapiAPI.get('/articles', { params });
    return data.data;
  };

  const getPromotionCampaigns = async () => {
    const now = new Date().toISOString();
    const { data } = await strapiAPI.get('/promotion-campaigns', {
      params: {
        populate: '*',
        sort: 'order:asc',
        filters: {
          is_active: { $eq: true },
          start_date: { $lte: now },
          end_date: { $gte: now }
        }
      }
    });
    return data.data;
  };

  return {
    getHeroBanners,
    getArticles,
    getPromotionCampaigns,
  };
};
```

---

## Content Summary

| Content Type | Type | Max Items | Ordering |
|--------------|------|-----------|----------|
| Hero Banner | Collection | 5 | Drag & Drop |
| Promotion Campaign | Collection | 3 | Drag & Drop |
| Province Card | Collection | 10 | Drag & Drop |
| Article Category | Collection | Unlimited | Drag & Drop |
| Article | Collection | Unlimited | By Date |
| FAQ Category | Collection | Unlimited | Drag & Drop |
| FAQ | Collection | Unlimited | Drag & Drop |
| Contact Us | Single | 1 | - |
| Privacy Policy | Single | 1 | - |

---

## Excluded from CMS (Connect to Internal System)

| Feature | Reason |
|---------|--------|
| Promotion Tickets | รอต่อระบบภายใน |
| User Bookings | ระบบภายใน |
| Vehicle Management | ระบบภายใน |
| Branch/Location Details | ระบบภายใน |

---

*Document Version: 1.0*
*Created: November 28, 2025*
